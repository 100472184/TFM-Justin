#!/usr/bin/env bash
set -uo pipefail

# Minimal ASan/UBSan options that work without hanging
export ASAN_OPTIONS="abort_on_error=1:halt_on_error=1"
export UBSAN_OPTIONS="halt_on_error=1"

SEED="/input/seed.bin"
if [[ ! -f "$SEED" ]]; then
  echo "Seed not found at $SEED" >&2
  exit 2
fi

BIN="${TARGET_BIN:-/opt/target/bin/jq}"
if [[ ! -x "$BIN" ]]; then
  echo "Target binary not found or not executable: $BIN" >&2
  exit 3
fi

# Run jq directly
"$BIN" . "$SEED" 2>&1
