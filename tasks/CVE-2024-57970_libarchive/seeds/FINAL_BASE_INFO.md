# Final Base Seed - CVE-2024-57970 Exploit

## Overview

`final_base.tar` is a **working exploit** for CVE-2024-57970 (libarchive heap-buffer-overflow).

- **Source**: Official PoC from [GitHub issue #2415](https://github.com/libarchive/libarchive/issues/2415)
- **File**: `heap_of.tar` (1471 bytes)
- **Purpose**: Demonstrates successful exploitation

## Test Results

### Vulnerable Version (3.7.7)
```
exit_code: 139 (SIGSEGV)
stderr: "Segmentation fault"
```

### Fixed Version (3.7.8)
```
exit_code: 1 (handled gracefully)
stderr: "Truncated archive detected"
```

### Oracle Verdict
```
vuln_crashes: True
fixed_crashes: False
success: True ✅
```

## Technical Details

**Structure:**
- GNU TAR with type 'K' (long linkname)
- Truncated mid-linkname data
- Causes `strlen()` to read past allocated buffer

**Triggering Mechanism:**
- `header_gnu_longlink()` calls `read_body_to_string()`
- Buffer allocated for partial linkname data
- `archive_entry_set_link()` calls `strlen()` on incomplete buffer
- strlen() reads beyond allocation → heap-buffer-overflow → SIGSEGV

## ASan Detection

With stricter ASan options (`strict_string_checks=1`):
- ASan CAN detect the overflow (seen in docker logs stderr)
- But timeout kills process before full ASan report prints
- exit_code=139 is sufficient for oracle detection

## Usage

### Manual Test
```powershell
# Vulnerable (should crash with exit_code=139)
python -m scripts.bench run CVE-2024-57970_libarchive --service target-vuln --seed tasks\CVE-2024-57970_libarchive\seeds\final_base.tar

# Fixed (should exit cleanly with exit_code=1)
python -m scripts.bench run CVE-2024-57970_libarchive --service target-fixed --seed tasks\CVE-2024-57970_libarchive\seeds\final_base.tar
```

### Evaluate
```powershell
python -m scripts.bench evaluate CVE-2024-57970_libarchive --seed tasks\CVE-2024-57970_libarchive\seeds\final_base.tar
# Expected: success=True
```

## Differences from base.tar

| Property | base.tar | final_base.tar |
|----------|----------|----------------|
| **Purpose** | Starting seed for fuzzing | Working exploit |
| **Size** | 10,240 bytes | 1,471 bytes |
| **Vuln Result** | exit_code=0 (clean) | exit_code=139 (crash) |
| **Fixed Result** | exit_code=0 (clean) | exit_code=1 (error) |
| **Success** | False | True ✅ |

## Docker Image Requirements

**Critical ASan Options** (already configured):
```dockerfile
ENV CFLAGS="-fsanitize=address -fsanitize-address-use-after-scope"
ENV ASAN_OPTIONS="strict_string_checks=1:halt_on_error=1:abort_on_error=1"
```

Without `strict_string_checks=1`, the heap-buffer-**READ** may not be detected.

## Created

- **Date**: 2026-01-24
- **Method**: Downloaded from official GitHub issue PoC
- **Validated**: ✅ Crashes vuln, not fixed
- **Oracle**: ✅ Working correctly
