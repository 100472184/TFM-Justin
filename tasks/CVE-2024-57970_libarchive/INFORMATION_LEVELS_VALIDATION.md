# Information Levels Validation - CVE-2024-57970

## Purpose
This document validates the incremental information structure across L0→L1→L2→L3 levels, ensuring proper separation for TFM research on LLM-guided fuzzing effectiveness.

## Level Definitions

### L0: Basic Description
**Files:** `L0_description.md`

**Content:**
- CVE ID and vulnerability type (heap buffer over-read, CWE-126)
- Root cause (truncation in GNU long linkname)
- Affected versions (≤3.7.7 vulnerable, 3.7.8 fixed)
- Target binary (`bsdtar`) and basic command
- General attack surface (TAR archives, truncation)
- Success indicators (ASan output vs clean exit)

**Excluded:**
- ❌ Patch details
- ❌ Code locations or function names beyond basic mention
- ❌ Specific mutation strategies
- ❌ Offsets, sizes, or numeric values
- ❌ TAR format technical details

**Information Density:** ~20 lines, purely descriptive

---

### L1: Description + Patch
**Files:** `L0_description.md` + `L1_description_patch.md`

**Additional Content:**
- Upstream fix details (PR #2422, Issue #2415, release 3.7.8)
- Patch behavior (before/after comparison)
- General vulnerability concept without tactics

**Excluded:**
- ❌ Specific mutation strategies or tactics
- ❌ Code snippets or stack traces
- ❌ Offsets, block sizes, or numeric targets
- ❌ TAR format structure details
- ❌ "Critical zones" or specific areas to target

**Information Density:** L0 + ~25 lines (conceptual understanding)

---

### L2: Partial Context
**Files:** `L0_description.md` + `L1_description_patch.md` + `L2_description_patch_and_file.md`

**Additional Content:**
- Vulnerable code location (file, function: `header_gnu_longlink`)
- ASan stack trace showing call chain
- Root cause mechanism (`strlen()` on incomplete buffer)
- TAR format context:
  * GNU long linkname structure (header type 'K'/'L', size field, data blocks)
  * 512-byte alignment (technical TAR detail, not exploitation hint)
  * Vulnerable scenario explanation
- **General mutation strategies** (no specific offsets):
  * Truncation approach
  * Size mismatch concept
  * Boundary conditions (abstract)
  * Format corruption ideas

**Excluded:**
- ❌ Specific offsets (637, 761, 768, etc.)
- ❌ Formulas for calculating offsets (e.g., `header_size + declared_length/2`)
- ❌ Numbered tactical steps with exact byte positions
- ❌ Source code snippets
- ❌ Precise mutation sequences

**Information Density:** L0 + L1 + ~50 lines (partial technical context)

---

### L3: Full Source Context
**Files:** All previous + `L3_full_source_context.md`

**Additional Content:**
- Complete technical deep dive
- GNU long linkname format with byte-level structure
- Vulnerability mechanics with code flow
- **Precise mutation strategies:**
  * Exact offsets: 562, 637, 761, 768 bytes
  * Formulas: `512 + (declared_size / 2)`, `512 + 256`, etc.
  * Base seed requirements (offset ranges 0-511, 512-1023, 1024+)
  * Numbered mutation targets with JSON examples
- High-value truncation offsets with rationale
- Benchmark environment details
- Iterative fuzzing guidance (Phase 1-3 with iteration ranges)
- Validation checklist with TAR magic bytes
- Success criteria with exact exit codes

**Information Density:** L0 + L1 + L2 + ~150 lines (complete exploitation guide)

---

## Validation Checklist

### Incremental Information Flow
✅ **L0→L1:** Adds patch details, no tactics  
✅ **L1→L2:** Adds code location, stack trace, TAR format, general strategies  
✅ **L2→L3:** Adds specific offsets, formulas, precise tactics  

### No Information Leakage
✅ **L0:** No offsets, no block sizes, no tactics  
✅ **L1:** No "512-byte blocks" mention, no "critical zones"  
✅ **L2:** No specific offsets (637, 761, 768), no formulas  
✅ **L3:** All specific information present  

### Key Differentiators

| Information Type | L0 | L1 | L2 | L3 |
|-----------------|----|----|----|----|
| CVE description | ✓ | ✓ | ✓ | ✓ |
| Patch details | ✗ | ✓ | ✓ | ✓ |
| Code location | ✗ | ✗ | ✓ | ✓ |
| Stack trace | ✗ | ✗ | ✓ | ✓ |
| TAR format (general) | ✗ | ✗ | ✓ | ✓ |
| General strategies | ✗ | ✗ | ✓ | ✓ |
| Specific offsets | ✗ | ✗ | ✗ | ✓ |
| Offset formulas | ✗ | ✗ | ✗ | ✓ |
| Precise tactics | ✗ | ✗ | ✗ | ✓ |

---

## Expected Research Outcomes

### Iteration Count to Success (Hypothesis)

**L3 (Full Context):**
- Expected: 2-4 iterations
- Rationale: Has exact offsets (637, 761, 768), can directly apply winning mutations

**L2 (Partial Context):**
- Expected: 8-15 iterations
- Rationale: Understands vulnerability and TAR format, must explore offset space
- Has general strategies but no specific numbers

**L1 (Description + Patch):**
- Expected: 20-50 iterations (if successful)
- Rationale: Knows what to look for (truncation) but lacks code/format context
- Low probability of success in reasonable time

**L0 (Minimal Information):**
- Expected: >50 iterations or failure
- Rationale: Only knows "truncation in GNU long linkname", no guidance
- Very low probability of success

### Validity for TFM Research

This incremental structure enables valid research questions:
1. **Information efficiency:** How does context level affect iterations-to-success?
2. **LLM capabilities:** What is minimum context for LLM to solve CVE?
3. **Feedback effectiveness:** Does `verify_history` compensate for missing context?
4. **Exploration strategies:** How does LLM explore without explicit offsets?

---

## Historical Issues (Resolved)

### Issue #1: L2 Information Leakage (Fixed: commit e5fc6cc)
**Problem:** L2 contained:
- "Critical offsets: Header + 0-100 bytes into linkname data"
- "Block boundaries (multiples of 512)"
- Formula: "header_size + (declared_length / 2)"
- Specific numbered mutation list

**Impact:** L2 could derive offsets close to L3's exact values (768, 637)

**Resolution:** Removed all specific offsets, formulas, and numeric hints from L2

### Issue #2: L1 Tactical Details (Fixed: commit 3c55796)
**Problem:** L1 contained:
- "Stress block boundaries (512-byte TAR blocks)"
- "Critical zones" section
- Numbered "Key mutations" list (5 items)
- Tactical exploitation guidance

**Impact:** L1 had mutation tactics that should only appear in L2+

**Resolution:** Removed "Exploitation Strategy" section, kept only patch behavior

### Issue #3: generate.j2 Template Leakage (Fixed: earlier commit)
**Problem:** Template had hardcoded CRITICAL section with CVE-specific offsets visible to all levels

**Impact:** Made information levels meaningless for CVE-2024-57970

**Resolution:** Removed CVE-specific hints, kept generic mutation examples

---

## Verification Procedure

To validate information level separation:

1. **Run L3 pipeline:**
   ```bash
   python -m agents.openhands_llama3.run --task-id CVE-2024-57970_libarchive --level L3 --max-iters 10
   ```
   - Check `iter_001/generate.json` for mutations
   - Should see truncate with offsets close to 768/637/761 by iteration 2-3

2. **Run L2 pipeline:**
   ```bash
   python -m agents.openhands_llama3.run --task-id CVE-2024-57970_libarchive --level L2 --max-iters 20
   ```
   - Check `iter_001-003/generate.json` for exploration pattern
   - Should NOT immediately find exact offsets
   - Should explore range around TAR blocks/headers
   - Expected success: iteration 8-15

3. **Run L1 pipeline:**
   ```bash
   python -m agents.openhands_llama3.run --task-id CVE-2024-57970_libarchive --level L1 --max-iters 30
   ```
   - Should attempt truncation (from patch description)
   - May struggle without TAR format knowledge
   - Expected success: iteration 20+ or timeout

4. **Compare results:**
   - L3 should succeed fastest (2-4 iters)
   - L2 should succeed slower (8-15 iters)
   - L1 should succeed much slower or fail (20+ iters)
   - L0 should fail or require >50 iters

---

## Status

**Information Levels:** ✅ Validated and properly separated  
**Template Leakage:** ✅ Resolved (no CVE-specific hints)  
**Docker Images:** ✅ Functional (ASan-only, no UBSan)  
**Differential Testing:** ✅ Working (vuln v3.7.7, fixed v3.7.8)  
**Ready for TFM:** ✅ Yes - valid research setup

**Last Updated:** 2026-01-22  
**Validation Commits:**
- `e5fc6cc` - Reduce L2 information level
- `3c55796` - Reduce L1 information level
- `7f889f4` - Fix Dockerfile.vuln (UBSan removal)
