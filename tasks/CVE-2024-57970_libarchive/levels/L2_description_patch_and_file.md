# CVE-2024-57970: Code Location and Call Chain

## Vulnerable Code

**File:** \libarchive/archive_read_support_format_tar.c\  
**Function:** \header_gnu_longlink
**Purpose:** Processes GNU long linkname extensions in TAR archives

## ASan Stack Trace (typical)

\AddressSanitizer: heap-buffer-overflow
  #0 strlen (libc)
  #1 header_gnu_longlink (archive_read_support_format_tar.c)
  #2 tar_read_header
  #3 archive_read_format_tar_read_header
  #4 archive_read_next_header
  #5 bsdtar main loop
\
**Root cause:** \strlen()\ called on incomplete buffer  reads past allocation

## TAR Format Context

**GNU long linkname structure:**
1. Special header with type flag 'K' or 'L'
2. Size field indicates linkname length
3. Linkname data follows in subsequent blocks (512-byte aligned)

**Vulnerable scenario:**
- Archive declares long linkname of N bytes
- Actual data < N bytes (truncated)
- Code reads declared N bytes without validation  heap over-read

## Mutation Targets

**Critical offsets:**
- Header + 0-100 bytes into linkname data
- Block boundaries (multiples of 512)
- Just before null terminator position

**Effective mutations:**
1. **Truncate at offset:** header_size + (declared_length / 2)
2. **Mismatch size field:** declare 512 bytes, provide 256
3. **Remove null terminator:** full length but no \x00
4. **Partial block:** truncate mid-block (not at 512 boundary)
5. **Cross-block boundary:** truncate spanning two 512-byte blocks

## Verification

**Vulnerable (3.7.7):**  
\AddressSanitizer: heap-buffer-overflow\ in stderr

**Fixed (3.7.8):**  
Exit code 1 (parsing error), no ASan output
