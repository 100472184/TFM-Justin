services:
  target-vuln:
    image: cvebench/cve-2024-57970_libarchive:vuln
    build:
      context: .
      dockerfile: docker/Dockerfile.vuln
    environment:
      - TARGET_BIN=/opt/target/bin/bsdtar
      - TZ=UTC
      - LANG=C
      - LC_ALL=C
    # ASLR disable: May work on Docker native Linux (Kali), not on Docker Desktop (Windows/WSL2)
    # Pipeline uses 3/5 crash threshold to handle potential heap non-determinism
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    cap_add:
      - SYS_PTRACE
    sysctls:
      - kernel.randomize_va_space=0
    network_mode: none
    mem_limit: 512m
    cpus: 1.0

  target-fixed:
    image: cvebench/cve-2024-57970_libarchive:fixed
    build:
      context: .
      dockerfile: docker/Dockerfile.fixed
    environment:
      - TARGET_BIN=/opt/target/bin/bsdtar
      - TZ=UTC
      - LANG=C
      - LC_ALL=C
    # ASLR disable: May work on Docker native Linux (Kali), not on Docker Desktop (Windows/WSL2)
    # Pipeline uses 3/5 crash threshold to handle potential heap non-determinism
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    cap_add:
      - SYS_PTRACE
    sysctls:
      - kernel.randomize_va_space=0
    network_mode: none
    mem_limit: 512m
    cpus: 1.0
